import plotly.graph_objects as go
from plotly.subplots import make_subplots
import pandas as pd

# Load your data
data = pd.read_csv('E:\\COMP4037_Research Methods\\cw2\\Results_21Mar2022.csv')

# Assuming diet_group entries are formatted like "meat <50_female_30-39"
# Simplify dietary group names or extract additional attributes
data['diet_base'] = data['diet_group'].apply(lambda x: x.split('_')[0])

# Optionally, extract gender and age range if necessary
data['gender'] = data['diet_group'].apply(lambda x: x.split('_')[1] if len(x.split('_')) > 1 else 'Unknown')
data['age_range'] = data['diet_group'].apply(lambda x: x.split('_')[2] if len(x.split('_')) > 2 else 'Unknown')

# Aggregate data on the simplified diet base
agg_data = data.groupby('diet_base').agg({
    'mean_acid': 'mean',
    'mean_watuse': 'mean',
    'sd_eut': 'mean',
    'mean_bio': 'mean'
}).reset_index()

# Define color scales
colorscales = {
    "Acidification": "YlOrRd",
    "Water Use": "Blues",
    "Variability in Eutrophication": "Viridis",
    "Biodiversity Impact": "OrRd"
}

# Setup subplots
fig = make_subplots(
    rows=2, cols=2,
    subplot_titles=tuple(colorscales.keys()),
    specs=[[{'type': 'treemap'}, {'type': 'treemap'}], [{'type': 'treemap'}, {'type': 'treemap'}]]
)

# Metrics to plot
metrics = ["mean_acid", "mean_watuse", "sd_eut", "mean_bio"]

# Add treemap traces to the subplot
for i, metric in enumerate(metrics):
    row = (i // 2) + 1
    col = (i % 2) + 1
    trace = go.Treemap(
        labels=agg_data['diet_base'],
        parents=[""] * len(agg_data),
        values=agg_data[metric],
        marker=dict(colorscale=colorscales[list(colorscales.keys())[i]], showscale=True),
        name=list(colorscales.keys())[i]
    )
    fig.add_trace(trace, row=row, col=col)

# Update the layout
fig.update_layout(
    height=800, width=1000,
    title_text="Environmental Impact by Dietary Type across Various Metrics",
    margin=dict(t=50, l=25, r=25, b=25)
)

# Display the figure
fig.show()
